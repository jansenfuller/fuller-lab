---
- name: Install K3s server on Alpine Linux
  hosts: k3s_server
  become: true
  tasks:

    - name: Ensure required packages are installed
      apk:
        name:
          - curl
          - bash
        update_cache: yes
        state: present

    - name: Download and install K3s
      shell: |
        curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server" sh -
      args:
        executable: /bin/bash

    - name: Wait for K3s service to start
      systemd:
        name: k3s
        state: started
        enabled: yes

    - name: Verify K3s is running
      shell: k3s kubectl get nodes
      register: k3s_status
      changed_when: false

    - name: Show K3s node status
      debug:
        var: k3s_status.stdout
